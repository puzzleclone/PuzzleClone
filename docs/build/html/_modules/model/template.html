

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>model.template &mdash; PuzzleClone v0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=2fea6348"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            PuzzleClone
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">PuzzleClone</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PuzzleClone</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">model.template</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for model.template</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">model_validator</span><span class="p">,</span> <span class="n">GetCoreSchemaHandler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic_core</span><span class="w"> </span><span class="kn">import</span> <span class="n">core_schema</span>

<div class="viewcode-block" id="Variable">
<a class="viewcode-back" href="../../model.html#model.template.Variable">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Variable</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Unified class for defining variables in puzzles.</span>

<span class="sd">    This class supports two mutually exclusive ways of defining variables:</span>
<span class="sd">    </span>
<span class="sd">    - By specifying `type` and `domain`.</span>

<span class="sd">    - By providing a custom formula in `formula`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The type of the variable.</span>

<span class="sd">    Example:</span>
<span class="sd">        - `&quot;int&quot;`: Represents an integer variable.</span>
<span class="sd">        - `&quot;bool&quot;`: Represents a boolean variable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The domain of the variable.</span>

<span class="sd">    Example:</span>
<span class="sd">        - `&quot;[1, 10]&quot;`: Represents integers from 1 to 10.</span>
<span class="sd">        - `&quot;[True, False]&quot;`: Represents boolean values.</span>
<span class="sd">        - `&quot;[&#39;red&#39;, &#39;blue&#39;, &#39;green&#39;]&quot;`: Represents a selection from the given options.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The formula used to initialize the variable.</span>

<span class="sd">    Example:</span>
<span class="sd">        - `&quot;randint(1,6) + randint(1,6)&quot;`: Represents the sum of two dice rolls.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Custom operators defined in the `custom_operator` field of the puzzle template can be used in the formula.</span>
<span class="sd">        - If `formula` is defined, `type` and `domain` must not be defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Variable.validate_exclusive_fields">
<a class="viewcode-back" href="../../model.html#model.template.Variable.validate_exclusive_fields">[docs]</a>
    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;after&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_exclusive_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates the mutually exclusive constraints between fields.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: </span>
<span class="sd">                - If both `formula` and `type`/`domain` are defined.</span>

<span class="sd">                - If `formula` is not defined, but `type` or `domain` is missing.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; DefinedVar(formula=&quot;x+y&quot;, type=&quot;int&quot;)  # Raises ValueError</span>
<span class="sd">            &gt;&gt;&gt; DefinedVar(type=&quot;int&quot;)  # Raises ValueError (missing `domain`)</span>
<span class="sd">            &gt;&gt;&gt; DefinedVar(type=&quot;int&quot;, domain=&quot;[1, 10]&quot;)  # Valid</span>
<span class="sd">            &gt;&gt;&gt; DefinedVar(formula=&quot;randint(1,6)&quot;)  # Valid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formula</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`formula` cannot be defined along with `type` or `domain`.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When `formula` is not defined, both `type` and `domain` must be defined.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
</div>


<div class="viewcode-block" id="DefinedSymbol">
<a class="viewcode-back" href="../../model.html#model.template.DefinedSymbol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DefinedSymbol</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for defining symbol templates used in puzzle generation.</span>

<span class="sd">    This class provides the fundamental structure for creating basic symbol elements in puzzles.</span>

<span class="sd">    Note: The base data structure is a dictionary, where the keys are the symbol names (or tuples when len(source) &gt; 1) and the values are the Z3 symbols.</span>

<span class="sd">    If only the list of Z3 symbols are needed, use `&lt;dict_name&gt;.to_list()` or `list(&lt;dict_name&gt;)` method to convert the dictionary values to a list.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialization expressions for the symbol, serving as primary keys.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - When length is 1: The primary key is a string.</span>

<span class="sd">          Example: source = [&quot;children&quot;] with children = [&quot;Alice&quot;, &quot;Bob&quot;] will generate two symbols </span>
<span class="sd">          with primary keys &quot;Alice&quot; and &quot;Bob&quot;.</span>
<span class="sd">          </span>
<span class="sd">        - When length &gt; 1: The primary key is a tuple.</span>
<span class="sd">        </span>
<span class="sd">          Example: source = [&quot;children&quot;, &quot;adults&quot;] with children = [&quot;Alice&quot;, &quot;Bob&quot;], adults = [&quot;Chris&quot;]</span>
<span class="sd">          will generate symbols with primary keys (&quot;Alice&quot;, &quot;Chris&quot;) and (&quot;Bob&quot;, &quot;Chris&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of symbol attributes defining additional characteristics.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - [&quot;color&quot;, &quot;size&quot;] indicates the symbol has color and size attributes.</span>
<span class="sd">        </span>
<span class="sd">    Notes:</span>
<span class="sd">        - When None (default), symbols can be accessed directly via dictionary keys (event[key]).</span>
<span class="sd">        - When specified, symbols must be accessed using get() method (event[key].get(&#39;color&#39;)).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Type definition rules for the symbol.</span>

<span class="sd">    Valid Values: &#39;int&#39; (default), &#39;bool&#39;, &#39;float&#39;, and &#39;enum&#39;.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - Single type string when attr is None: &quot;Bool&quot;</span>
<span class="sd">        - Type list matching attr length when attr exists: [&quot;int&quot;, &quot;bool&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description template for the symbol.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - Single string when no attributes: &quot;Basic proposition symbol&quot;</span>
<span class="sd">        - List matching attr length when attributes exist: [&quot;Color description&quot;, &quot;Size description&quot;]</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DefinedSymbol.validate_type_desc_based_on_attr">
<a class="viewcode-back" href="../../model.html#model.template.DefinedSymbol.validate_type_desc_based_on_attr">[docs]</a>
    <span class="nd">@model_validator</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;before&#39;</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_type_desc_based_on_attr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates consistency between attributes, types and descriptions.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                - ``attr`` is ``None``, but ``type`` is a list.</span>
<span class="sd">                </span>
<span class="sd">                - ``attr`` exists, but ``type`` is not a list.</span>

<span class="sd">                - The format of ``desc`` does not match the presence of ``attr``.</span>

<span class="sd">        Examples:</span>
<span class="sd">            &gt;&gt;&gt; DefinedSymbol(source=[&quot;A&quot;], attr=[&quot;color&quot;], type=&quot;Str&quot;)  # Raises ValueError</span>
<span class="sd">            &gt;&gt;&gt; DefinedSymbol(source=[&quot;A&quot;], desc=[&quot;desc1&quot;, &quot;desc2&quot;])  # Raises ValueError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;attr&#39;</span><span class="p">)</span>
        <span class="n">type_val</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="n">desc_val</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;desc&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># 当 attr 为 None 时，type 应该是 str，desc 应该是 Optional[str]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When attr is None, type must be str&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">desc_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">desc_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When attr is None, desc must be str or None&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 当 attr 是 list 时，type 和 desc 也应该是 list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When attr is list, type must be list&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">desc_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">desc_val</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When attr is list, desc must be list or None&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">values</span></div>
</div>


<div class="viewcode-block" id="DerivedSymbol">
<a class="viewcode-back" href="../../model.html#model.template.DerivedSymbol">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DerivedSymbol</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class defining rules for generating derived symbols from existing ones.</span>
<span class="sd">    </span>
<span class="sd">    The derivation works by first randomly selecting a number of values from the `source` list and creating new symbols with the selected values.</span>

<span class="sd">    Selection Process (before optimization):</span>
<span class="sd">    </span>
<span class="sd">    1. For each domain (total count specified by ``domain``):</span>
<span class="sd">        a. For each dimension (count specified by ``dim``):</span>
<span class="sd">            i. For each data source in ``source``:</span>
<span class="sd">                - Select ``amount[k]`` items from ``source[k]`` following ``order`` and ``duplicate`` rules</span>
<span class="sd">        b. Verify dimension-level conditions (``dim_cond`` and custom conditions with scope=&#39;dim&#39;)</span>
<span class="sd">    2. Verify domain-level conditions (``domain_cond`` and custom conditions with scope=&#39;domain&#39;)</span>

<span class="sd">    Example</span>

<span class="sd">    .. code-block:: python</span>

<span class="sd">        &quot;max_num&quot;: {</span>
<span class="sd">            &quot;source&quot;: [&quot;range(p_num)&quot;, &quot;range(2, 11)&quot;],</span>
<span class="sd">            &quot;domain&quot;: &quot;3&quot;,</span>
<span class="sd">            &quot;custom_cond&quot;: [{</span>
<span class="sd">                &quot;scope&quot;: &quot;domain&quot;,</span>
<span class="sd">                &quot;fields&quot;: [0, 1],</span>
<span class="sd">                &quot;constraint&quot;: &quot;lambda l: all([item[0][1][0] &lt; money // prices[item[0][0][0]] for item in l])&quot;</span>
<span class="sd">            }],</span>
<span class="sd">            &quot;formula&quot;: &quot;num[names[_sym[0]]] &lt;= _sym[1]&quot;,</span>
<span class="sd">            &quot;desc&quot;: &quot;The maximum number of Award {names[_sym[0]]} that a person can take is {_sym[1]}.&quot;</span>
<span class="sd">        }</span>

<span class="sd">    This configuration will:</span>

<span class="sd">    - Generate 3 symbols (``domain = 3``)</span>

<span class="sd">    - Each symbol has 1 dimension (default ``dim = 1``)</span>

<span class="sd">    - Each dimension uses 2 data sources (``len(source) = 2``)</span>

<span class="sd">    - The first source provides integers from 0 to ``p_num - 1``</span>

<span class="sd">    - The second source provides integers from 2 to 10</span>

<span class="sd">    - Selects 1 item from each source (default when ``amount`` is None)</span>

<span class="sd">    - Applies custom domain-level constraint on the selected values</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data sources for the selection. </span>

<span class="sd">    Each element must be a string representing either:</span>

<span class="sd">    - A stringified list of literals (e.g., &#39;[True, False]&#39;)</span>

<span class="sd">    - A variable name containing the data</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">amount</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of items selected from each data source.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - [&quot;2&quot;, &quot;1&quot;]: Select 2 items from first source, 1 from second</span>

<span class="sd">        - None: Select exactly 1 item from each source (default)</span>

<span class="sd">    Note:</span>
<span class="sd">        - Length must match ``source``</span>

<span class="sd">        - Each value must be a string (literal or variable name)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Permutation configuration per data source during selection.</span>
<span class="sd">    </span>
<span class="sd">    Controls whether selection order matters:</span>

<span class="sd">    - True: Permutation (order matters)</span>

<span class="sd">    - False: Combination (order doesn&#39;t matter)</span>

<span class="sd">    Default:</span>
<span class="sd">        All True (order matters for all sources)</span>

<span class="sd">    Note:</span>
<span class="sd">        Length must match ``source``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">duplicate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selection repetition rules per data source during selection.</span>
<span class="sd">    </span>
<span class="sd">    Controls whether duplicates are allowed:</span>

<span class="sd">    - True: Allow duplicate selections</span>

<span class="sd">    - False: Disallow duplicates</span>

<span class="sd">    Default:</span>
<span class="sd">        All False (no duplicates allowed)</span>

<span class="sd">    Note:</span>
<span class="sd">        Length must match ``source``</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of selections.</span>

<span class="sd">    Examples:</span>
<span class="sd">        - &quot;5&quot;: Make 5 selections from the data sources</span>
<span class="sd">        - &quot;n&quot;: Use variable `n` to determine count</span>

<span class="sd">    Note:</span>
<span class="sd">        Must be a string representing a literal or variable name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_cond</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global repetition rule for symbol selection:</span>
<span class="sd">    </span>
<span class="sd">    Controls whether identical symbol combinations are allowed:</span>

<span class="sd">    - True: Disallow identical combinations</span>

<span class="sd">    - False: Allow duplicates</span>

<span class="sd">    Default:</span>
<span class="sd">        True (no identical combinations)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of dimensions for the derived symbol.</span>

<span class="sd">    Example: </span>
<span class="sd">        - 2 generates two-dimensional symbol matrix (useful for statements with multiple clauses).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dim_cond</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inter-dimensional constraints (list of conditions).</span>

<span class="sd">    Example: </span>
<span class="sd">        - [[0, 1], [2]] means values from `source[0]` and `source[1]` cannot be identical at the same time AND values from `source[2]` cannot be identical.</span>

<span class="sd">    Note: </span>
<span class="sd">        - Cannot contain duplicate indices.</span>

<span class="sd">    Default: </span>
<span class="sd">        - [[0, 1, ..., `len(source)`]] (i.e., all selections must be different in at least one source).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">custom_cond</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom constraint dictionaries containing:</span>
<span class="sd">    </span>
<span class="sd">    - scope: Application level (&#39;domain&#39;/&#39;dim&#39;)</span>

<span class="sd">    - fields: List of field indices from source</span>

<span class="sd">    - constraint: Constraint logic expression. Must be a valid Python lambda function string. </span>
<span class="sd">        - When scope=&quot;domain&quot;, the input is a 4-dimensional list, where the selected values can be fetched by `l[domain_index][dim_index][source_index (in &#39;fields&#39;)][amount_index]`.</span>
<span class="sd">        - When scope=&quot;dim&quot;, the input is a 3-dimensional list, where the selected values can be fetched by `l[dim_index][source_index (in &#39;fields&#39;)][amount_index]`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">formula</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol generation formula using Python syntax.&quot;&quot;&quot;</span>

    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Symbol collection description text for puzzle generation.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="DerivedSymbols">
<a class="viewcode-back" href="../../model.html#model.template.DerivedSymbols">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DerivedSymbols</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for multiple derived symbol templates with random counts.&quot;&quot;&quot;</span>

    <span class="n">total</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of symbols to generate.&quot;&quot;&quot;</span>

    <span class="n">templates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DerivedSymbol</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of symbol templates for generation.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="StaticCondition">
<a class="viewcode-back" href="../../model.html#model.template.StaticCondition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">StaticCondition</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base constraint definition for puzzle rules.&quot;&quot;&quot;</span>

    <span class="n">formula</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constraint logic expression using Python syntax.</span>

<span class="sd">    Example: &quot;x + y &lt; 10&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">desc</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Natural language description for puzzle text generation.</span>

<span class="sd">    Example: &quot;Sum of two numbers must be less than 10&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="DynamicCondition">
<a class="viewcode-back" href="../../model.html#model.template.DynamicCondition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DynamicCondition</span><span class="p">(</span><span class="n">StaticCondition</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extended constraints with multi-dimensional parameters.&quot;&quot;&quot;</span>

    <span class="n">source</span><span class="p">:</span> <span class="nb">list</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data sources (same format as DerivedSymbol).&quot;&quot;&quot;</span>

    <span class="n">amount</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of selections per data source. (same format as DerivedSymbol)&quot;&quot;&quot;</span>

    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Permutation configuration (default all True).&quot;&quot;&quot;</span>

    <span class="n">duplicate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Repetition rule configuration (default all False).&quot;&quot;&quot;</span>

    <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total condition count. Must be a range string &quot;[min, max]&quot;. If None, one condition will be generated.</span>
<span class="sd">    </span>
<span class="sd">    Example:</span>
<span class="sd">        - &quot;[1, 5]&quot;: Generate between 1 and 5 conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">domain_cond</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Global repetition rule.&quot;&quot;&quot;</span>

    <span class="n">custom_cond</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom constraints (same format as DerivedSymbol).&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="PostGen">
<a class="viewcode-back" href="../../model.html#model.template.PostGen">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PostGen</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialization after computing the problem solution for the first time. (Applicable for scenarios where parameters in the actual problem need to be computed using z3)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">post_gen_vars</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extracting the values of symbols from _sol (the selected solution) as new variables.</span>
<span class="sd">    </span>
<span class="sd">    Key: The new variable name.</span>

<span class="sd">    Value: The expression to compute the variable value, which can be a string of a Python expression.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">post_gen_conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">StaticCondition</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;New constraints to add after initial solution.</span>
<span class="sd">    </span>
<span class="sd">    Key: The new constraint name.</span>

<span class="sd">    Value: A string of the formula for the constraint.</span>
<span class="sd">    &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="Optimize">
<a class="viewcode-back" href="../../model.html#model.template.Optimize">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Optimize</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimization target definition (for optimization problems only).&quot;&quot;&quot;</span>

    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimization type (&quot;minimize&quot; or &quot;maximize&quot;).&quot;&quot;&quot;</span>

    <span class="n">formula</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Formula to optimize.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="QueryBase">
<a class="viewcode-back" href="../../model.html#model.template.QueryBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QueryBase</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for question definitions.&quot;&quot;&quot;</span>

    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Question description text (may contain placeholders).</span>

<span class="sd">    Example: &quot;Which option satisfies the condition?&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="QuerySelectionBase">
<a class="viewcode-back" href="../../model.html#model.template.QuerySelectionBase">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuerySelectionBase</span><span class="p">(</span><span class="n">QueryBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiple-choice question definition.&quot;&quot;&quot;</span>

    <span class="n">query_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;single_choice&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Question type:</span>
<span class="sd">    </span>
<span class="sd">    - &#39;single_choice&#39;: Single correct answer</span>
<span class="sd">    - &#39;multiple_choice&#39;: Multiple correct answers</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">select_type</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to select the correct or incorrect option(s):</span>
<span class="sd">    </span>
<span class="sd">    - True: Select the correct option(s)</span>
<span class="sd">    - False: Select the incorrect option(s)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">opt_num</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Total number of options to present (default 4).&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="QuerySelectionTemplate">
<a class="viewcode-back" href="../../model.html#model.template.QuerySelectionTemplate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuerySelectionTemplate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Template for multiple-choice options.</span>
<span class="sd">    </span>
<span class="sd">    The option generation process works by randomly selecting a number of values from the `source` list to create options.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">source</span><span class="p">:</span> <span class="nb">list</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Data source. (Same format as DerivedSymbol.source)&quot;&quot;&quot;</span>

    <span class="n">amount</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of selections per source. (Same format as DerivedSymbol.amount)&quot;&quot;&quot;</span>

    <span class="n">order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Permutation configuration (default first dimension False, others True).&quot;&quot;&quot;</span>

    <span class="n">duplicate</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Repetition rule configuration. (default all False)&quot;&quot;&quot;</span>

    <span class="n">cond</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;any&#39;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Constraint scope:</span>
<span class="sd">    </span>
<span class="sd">    - &#39;any&#39;: At least one solution satisfies</span>

<span class="sd">    - &#39;all&#39;: All solutions satisfy</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">opt_formula</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Option correctness evaluation expression.</span>

<span class="sd">    Example: &quot;x % 2 == 0&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">opt_text</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Option display template (may contain placeholders).</span>

<span class="sd">    Example: &quot;{_opt[0][0]}&quot;</span>

<span class="sd">    Note:</span>
<span class="sd">        - Automatically prefixed with ABCD, no need to include in string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">custom_cond</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Custom constraints (same format as DerivedSymbol.custom_cond).&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="QuerySelectionWithSingleTemplate">
<a class="viewcode-back" href="../../model.html#model.template.QuerySelectionWithSingleTemplate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuerySelectionWithSingleTemplate</span><span class="p">(</span><span class="n">QuerySelectionBase</span><span class="p">,</span> <span class="n">QuerySelectionTemplate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Single template for multiple-choice questions.&quot;&quot;&quot;</span>
    <span class="k">pass</span></div>



<div class="viewcode-block" id="QuerySelectionWithMultipleTemplates">
<a class="viewcode-back" href="../../model.html#model.template.QuerySelectionWithMultipleTemplates">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">QuerySelectionWithMultipleTemplates</span><span class="p">(</span><span class="n">QuerySelectionBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Multiple templates for multiple-choice questions.&quot;&quot;&quot;</span>

    <span class="n">templates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">QuerySelectionTemplate</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;List of option templates.&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="Query">
<a class="viewcode-back" href="../../model.html#model.template.Query">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Query</span><span class="p">(</span><span class="n">QueryBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open-ended question definition.&quot;&quot;&quot;</span>

    <span class="n">ans_formula</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Answer generation formula.&quot;&quot;&quot;</span>

    <span class="n">ans_text</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Answer text format.&quot;&quot;&quot;</span>

    <span class="n">ans_assertion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;len(_solutions) == 1&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Assertion for answer validation.&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="PuzzleTemplate">
<a class="viewcode-back" href="../../model.html#model.template.PuzzleTemplate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PuzzleTemplate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main puzzle template structure integrating all components.&quot;&quot;&quot;</span>

    <span class="n">custom_operator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of custom operators.</span>

<span class="sd">    Key: Operator name.</span>

<span class="sd">    Value: Python expression string defining the operator OR the path to a Python file containing the operator definition.</span>
<span class="sd">    </span>
<span class="sd">    Example: {&quot;double&quot;: &quot;lambda x: x * 2&quot;, &quot;reformat&quot;: &quot;customs/mathexpr_generator.py&quot;}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Variable</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of variable definitions (name: definition).&quot;&quot;&quot;</span>

    <span class="n">symbols</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">DefinedSymbol</span><span class="p">,</span> <span class="n">DerivedSymbols</span><span class="p">,</span> <span class="n">DerivedSymbol</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of symbol definitions (name: definition).&quot;&quot;&quot;</span>

    <span class="n">conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">StaticCondition</span><span class="p">,</span> <span class="n">DynamicCondition</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of conditions.&quot;&quot;&quot;</span>

    <span class="n">calc_solution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to compute solutions (default True).&quot;&quot;&quot;</span>

    <span class="n">max_solution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6000</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Maximum number of solutions to generate.</span>
<span class="sd">    </span>
<span class="sd">    Note:</span>
<span class="sd">        - Here, &quot;solution&quot; refers to a valid configuration of all symbols that satisfies all constraints. It does NOT mean the number of valid answers to the final question.</span>
<span class="sd">        - If the number of solutions exceeds this limit, the solver will stop and raise an exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">post_generation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PostGen</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Post-generation configuration including:</span>
<span class="sd">    </span>
<span class="sd">    - post_gen_vars: New variables from solutions</span>
<span class="sd">    - post_gen_conditions: Additional constraints</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optimize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Optimize</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimization target (for optimization problems only).&quot;&quot;&quot;</span>

    <span class="n">queries</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">QuerySelectionWithMultipleTemplates</span><span class="p">,</span> <span class="n">QuerySelectionWithSingleTemplate</span><span class="p">,</span> <span class="n">Query</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of question definitions.&quot;&quot;&quot;</span>

    <span class="n">desc</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overall template description for puzzle introduction.&quot;&quot;&quot;</span></div>


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Anonymous Authors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>